## ğŸ¤– Assistant

å¯ä»¥ï¼Œè€Œä¸”**å¼ºçƒˆå»ºè®®**æŠŠåŠ å¯†ç®—æ³•ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦æˆç‹¬ç«‹æ¨¡å—ï¼ˆCrypto Agility / Algorithm Agilityï¼‰ï¼Œè¿™æ ·åç»­æ–°å¢/æ›¿æ¢ç®—æ³•ï¼ˆå¦‚ä» AES-GCM åˆ‡åˆ° XChaCha20-Poly1305ï¼Œæˆ–å‡çº§ KDF å‚æ•°ï¼‰ä¸ä¼šç‰µåŠ¨åŒæ­¥ã€å­˜å‚¨ã€UI ç­‰å¤§é‡ä»£ç ï¼Œå¹¶ä¸”èƒ½åšåˆ°**å‘åå…¼å®¹è§£å¯†**ä¸**å¯æ§çš„ç®—æ³•å‡çº§**ã€‚

ä¸‹é¢ç»™å‡ºä¸€ä»½å¯ç›´æ¥çº³å…¥æ‚¨ TAD çš„â€œæ¶æ„æ”¹åŠ¨è¡¥å……â€ï¼Œæ‚¨å¯ä»¥å¤åˆ¶åˆ° Wordï¼›æˆ‘ä¹Ÿç»™å‡ºâ€œå¦‚ä½•å¿«é€Ÿç”Ÿæˆ docxâ€çš„æ–¹æ³•ã€‚

---

## ï¼ˆå»ºè®®æ–°å¢ï¼‰5.1.3 å¯†ç å­¦æ¨¡å—åŒ–ä¸ç®—æ³•å¯æ¼”è¿›ï¼ˆCrypto Module & Agilityï¼‰

### 5.1.3.1 ç›®æ ‡
- **ç®—æ³•å¯æ’æ‹”**ï¼šåŠ å¯†/è§£å¯†ã€ç­¾åã€KDFã€éšæœºæ•°ç”Ÿæˆå‡é€šè¿‡æ¥å£æŠ½è±¡ï¼Œç®—æ³•å®ç°å¯æ›¿æ¢ã€‚
- **å‘åå…¼å®¹**ï¼šå†å²æ•°æ®ç”¨æ—§ç®—æ³•åŠ å¯†ä¹Ÿå¿…é¡»å¯è§£å¯†ï¼›æ–°æ•°æ®æŒ‰ç­–ç•¥ä½¿ç”¨æ–°ç®—æ³•ã€‚
- **é˜²é™çº§æ”»å‡»**ï¼šç¦æ­¢æ”»å‡»è€…æŠŠç®—æ³•æ ‡è¯†ç¯¡æ”¹ä¸ºå¼±ç®—æ³•å¯¼è‡´å®¢æˆ·ç«¯â€œè¢«è¿«é™çº§è§£å¯†/é‡åŠ å¯†â€ã€‚

### 5.1.3.2 æ¨¡å—è¾¹ç•Œä¸åˆ†å±‚
å°†é¢†åŸŸå±‚çš„ `Crypto Svc` æ‹†ä¸ºç‹¬ç«‹æ¨¡å—ï¼ˆå¯ä½œä¸ºå•ç‹¬ Dart package / æˆ– FFI åŠ¨æ€åº“ï¼‰ï¼š

- **crypto-coreï¼ˆæ¥å£ä¸æ•°æ®æ ¼å¼å±‚ï¼‰**
 - å®šä¹‰ï¼šç®—æ³•æ ‡è¯†ã€å¯†æ–‡å°è£…æ ¼å¼ï¼ˆCiphertext Envelopeï¼‰ã€ç»Ÿä¸€æ¥å£ï¼ˆKDF/AEAD/Signer/KeyWrap/RNGï¼‰
 - ä¸åŒ…å«å…·ä½“ç®—æ³•å®ç°ï¼ˆæˆ–ä»…åŒ…å«å‚è€ƒå®ç°ï¼‰

- **crypto-provider-*ï¼ˆç®—æ³•å®ç°å±‚ï¼Œå¯å¤šå®ç°å¹¶å­˜ï¼‰**
 - `crypto-provider-aesgcm`ï¼ˆAES-256-GCMï¼‰
 - `crypto-provider-xchacha20`ï¼ˆXChaCha20-Poly1305ï¼Œå¯é€‰ï¼‰
 - `crypto-provider-argon2id`ï¼ˆArgon2id KDFï¼‰
 - `crypto-provider-hkdf`ï¼ˆHKDF-SHA256ï¼‰
 - `crypto-provider-sign-p256`ï¼ˆECDSA P-256 / Ed25519 äº¦å¯é€‰ï¼‰

- **crypto-policyï¼ˆç­–ç•¥é€‰æ‹©å±‚ï¼‰**
 - æ ¹æ®å¹³å°èƒ½åŠ›ï¼ˆæ˜¯å¦æ”¯æŒç¡¬ä»¶åŠ é€Ÿ/TEEï¼‰ã€åˆè§„ç­–ç•¥ã€æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœé€‰æ‹©ç®—æ³•ä¸å‚æ•°
 - è¾“å‡ºâ€œå…è®¸è§£å¯†é›†åˆâ€â€œé»˜è®¤åŠ å¯†å¥—ä»¶â€â€œæœ€ä½å¯æ¥å—ç‰ˆæœ¬â€

### 5.1.3.3 ç»Ÿä¸€æ¥å£è§„èŒƒï¼ˆç¤ºä¾‹ï¼‰
> å…³é”®ç‚¹ï¼šä¸šåŠ¡å±‚åªä¾èµ–æ¥å£ï¼Œä¸ä¾èµ–å…·ä½“ç®—æ³•åº“ï¼›é€šè¿‡ä¾èµ–æ³¨å…¥/æœåŠ¡å®šä½åŠ è½½ Providerã€‚

```dart
abstract interface class Kdf {
  String get id; // e.g. "argon2id"
  KdfParams calibrate(); // åŸºå‡†æµ‹è¯•è¾“å‡ºå‚æ•°
  Uint8List deriveKey({
    required String password,
    required Uint8List salt,
    required KdfParams params,
    required int length,
  });
}

abstract interface class AeadCipher {
  String get id; // e.g. "aes-256-gcm"
  EncryptedBox seal({
    required Uint8List plaintext,
    required Uint8List key,
    required Uint8List nonce,
    required Uint8List aad,
  });
  Uint8List open({
    required EncryptedBox box,
    required Uint8List key,
    required Uint8List aad,
  });
}

abstract interface class KeyWrap {
  String get id; // e.g. "aes-kw" / "rsa-oaep" / "ecies"
  Uint8List wrap({required Uint8List kek, required Uint8List dek});
  Uint8List unwrap({required Uint8List kek, required Uint8List wrappedDek});
}

abstract interface class Signer {
  String get id; // e.g. "ecdsa-p256-sha256"
  Uint8List sign(Uint8List message);
  bool verify(Uint8List message, Uint8List signature);
}
```

### 5.1.3.4 å¯†æ–‡å°è£…æ ¼å¼ï¼ˆCiphertext Envelopeï¼‰â€”â€”å®ç°ç®—æ³•å¯æ›´æ–°çš„æ ¸å¿ƒ
æ‰€æœ‰åŠ å¯†äº§ç‰©ï¼ˆå¡ç‰‡ payloadã€äº‹ä»¶æ—¥å¿—ã€å¿«ç…§ï¼‰ç»Ÿä¸€ä½¿ç”¨â€œè‡ªæè¿°â€å¯†æ–‡æ ¼å¼ï¼Œè‡³å°‘åŒ…å«ï¼š

- `schemaVersion`ï¼šå°è£…æ ¼å¼ç‰ˆæœ¬ï¼ˆç”¨äºå°†æ¥æ‰©å±•å­—æ®µï¼‰
- `suiteId`ï¼šç®—æ³•å¥—ä»¶ IDï¼ˆAEAD + KDF + Wrap + Signï¼‰
- `kdfParams`ï¼šKDF å‚æ•°ï¼ˆArgon2id çš„ memory/iterations/parallelism ç­‰ï¼‰
- `keyId / keyVersion`ï¼šå¯†é’¥ç‰ˆæœ¬ï¼ˆæ”¯æŒ KEK/DEK è½®æ¢ï¼‰
- `nonce`ï¼šéšæœºæ•°
- `aad` ç»‘å®šå­—æ®µï¼ˆå¦‚ eventIdã€cardIdã€hlcã€deviceIdï¼‰ï¼Œé˜²æ­¢å¯†æ–‡è¢«å‰ªåˆ‡/é‡æ”¾åˆ°åˆ«å¤„

**ç¤ºä¾‹ï¼ˆé€»è¾‘ç»“æ„ï¼‰**ï¼š
```json
{
  "schemaVersion": 1,
  "suiteId": "ZTDPM_SUITE_2026_01",
  "aead": "aes-256-gcm",
  "kdf": { "id": "argon2id", "m": 65536, "t": 3, "p": 4, "salt": "..." },
  "key": { "dekVersion": 7, "kekBinding": "tee-bound" },
  "nonce": "...",
  "ciphertext": "...",
  "tag": "...",
  "aadMeta": { "eventId": "...", "cardId": "...", "hlc": "..." }
}
```

### 5.1.3.5 ç®—æ³•å‡çº§ä¸å…¼å®¹ç­–ç•¥ï¼ˆå¿…é¡»å†™è¿›æ¶æ„çº¦æŸï¼‰
- **è§£å¯†ç­–ç•¥**ï¼šå…è®¸è§£å¯† `suiteId âˆˆ AllowedSuites` çš„å†å²æ•°æ®ã€‚
- **åŠ å¯†ç­–ç•¥**ï¼šåªä½¿ç”¨ `DefaultSuite`ï¼ˆæœ€æ–°ä¸”æ»¡è¶³æœ€ä½å®‰å…¨é—¨æ§›ï¼‰ã€‚
- **é‡åŠ å¯†ç­–ç•¥ï¼ˆå¯é€‰ï¼‰**ï¼šåå°æ¸è¿›å¼é‡åŠ å¯†ï¼ˆidle æ—¶ï¼‰ï¼ŒæŠŠæ—§å¥—ä»¶æ•°æ®è¿ç§»åˆ°æ–°å¥—ä»¶ã€‚
- **é˜²é™çº§**ï¼š
 1. `AllowedSuites` ç”±åº”ç”¨å†…ç½® + ç­¾åæ›´æ–°ï¼ˆç­–ç•¥æ–‡ä»¶éœ€ç­¾åï¼‰
 2. è‹¥å¯†æ–‡ `suiteId` ä¸åœ¨å…è®¸é›†åˆï¼šç›´æ¥æ‹’ç»è§£å¯†å¹¶å‘Šè­¦
 3. `suiteId` ä¸ AAD ç»‘å®šï¼Œä¸”äº‹ä»¶æœ¬èº«æœ‰ç­¾å/å“ˆå¸Œé“¾ï¼Œé¿å…è¢«ç¯¡æ”¹ä¸ºå¼±ç®—æ³•

### 5.1.3.6 å¯¹ç°æœ‰æ¶æ„çš„æœ€å°æ”¹åŠ¨ç‚¹
- å°†åŸ `å¯†ç å­¦æœåŠ¡ (Crypto Svc)` è°ƒæ•´ä¸ºï¼š
 - `CryptoFacadeï¼ˆé—¨é¢ï¼‰`ï¼šä¾› Vault/Sync/Event è°ƒç”¨çš„ç¨³å®š API
 - `CryptoRegistryï¼ˆæ³¨å†Œè¡¨ï¼‰`ï¼šç®¡ç†å¤šä¸ª Provider ä¸ Suite
 - `CryptoPolicyEngineï¼ˆç­–ç•¥å¼•æ“ï¼‰`ï¼šé€‰æ‹©é»˜è®¤å¥—ä»¶ã€æ ¡éªŒå¯ç”¨å¥—ä»¶
- äº‹ä»¶ç»“æ„ä¸­çš„ `EncryptedPayload` æ”¹ä¸º `CiphertextEnvelope`ï¼ˆæˆ–åœ¨ payload å†…åŒ…å« suite ä¿¡æ¯ï¼‰

---

## ï¼ˆå»ºè®®åœ¨è·¯çº¿å›¾ä¸­å¢åŠ ï¼‰äº¤ä»˜é¡¹è°ƒæ•´
åœ¨ **Phase 1 æ ¸å¿ƒå¯†ç å­¦**ä¸­å¢åŠ ï¼š
- crypto-coreï¼ˆæ¥å£ + å¯†æ–‡å°è£…æ ¼å¼ + æµ‹è¯•å‘é‡ï¼‰
- è‡³å°‘ 1 ä¸ªé»˜è®¤ providerï¼ˆAES-GCM + Argon2idï¼‰
- suite/ç­–ç•¥æ–‡ä»¶ç­¾åæ ¡éªŒï¼ˆé˜²é™çº§ï¼‰

---

## å¦‚ä½•â€œæ–°å»º Microsoft Word æ–‡æ¡£.docxâ€
æˆ‘æ— æ³•åœ¨å¯¹è¯é‡Œç›´æ¥æŠŠäºŒè¿›åˆ¶ `.docx` ä½œä¸ºé™„ä»¶ç”Ÿæˆç»™æ‚¨ï¼Œä½†å¯ä»¥ç”¨ä¸¤ç§æœ€å¿«æ–¹å¼å¾—åˆ° Word æ–‡ä»¶ï¼š

1) **å¤åˆ¶ç²˜è´´**
æŠŠæˆ‘ä¸Šé¢è¿™æ®µâ€œ5.1.3 â€¦â€ç›´æ¥å¤åˆ¶åˆ° Wordï¼Œä½œä¸ºæ‚¨ TAD çš„æ–°å¢ç« èŠ‚ã€‚

2) **Markdown è½¬ docxï¼ˆæ¨èï¼Œå¯è‡ªåŠ¨æ’ç‰ˆï¼‰**
- å°†å…¨æ–‡ä¿å­˜ä¸º `TAD.md`
- ä½¿ç”¨ pandoc è½¬æ¢ï¼š
```bash
pandoc TAD.md -o é›¶ä¿¡ä»»åˆ†å¸ƒå¼å¯†ç ç®¡ç†å™¨æŠ€æœ¯æ¶æ„æ–‡æ¡£.docx
```
å¦‚éœ€ä¼ä¸šæ¨¡æ¿ï¼ˆé¡µçœ‰é¡µè„š/å°é¢/ç›®å½•æ ·å¼ï¼‰ï¼Œæˆ‘å¯ä»¥æŒ‰æ‚¨çš„æ¨¡æ¿å­—æ®µï¼ˆå…¬å¸åã€å¯†çº§ã€ç¼–å·ã€å­—ä½“ï¼‰æŠŠå†…å®¹æ•´ç†æˆå¯ç›´æ¥è½¬æ¢çš„ Markdown/Word å¤§çº²ã€‚

---

å¦‚æœæ‚¨å¸Œæœ›æˆ‘æŠŠâ€œåŸæ–‡æ¡£â€é‡Œç›¸å…³éƒ¨åˆ†ï¼ˆ5.1 å¯†ç å­¦æ¶æ„ã€äº‹ä»¶ç»“æ„ã€è·¯çº¿å›¾ã€é£é™©æ¡ç›®ï¼‰ä¹Ÿä¸€å¹¶**æ”¹å†™æˆæ¨¡å—åŒ–åçš„å®Œæ•´ä¸€è‡´ç‰ˆæœ¬**ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š
1) æ‚¨å€¾å‘çš„å®ç°æ–¹å¼ï¼šçº¯ Dart / Dart+FFI(Rust) / ç›´æ¥è°ƒç”¨å¹³å°åŸç”Ÿåº“
2) è®¡åˆ’æ”¯æŒçš„ç®—æ³•å€™é€‰ï¼šæ˜¯å¦è¦ä¸Š XChaCha20-Poly1305ã€Ed25519 ç­‰
3) æ˜¯å¦éœ€è¦â€œç­–ç•¥æ–‡ä»¶åœ¨çº¿æ›´æ–°â€ï¼ˆå¸¦ç­¾åï¼‰è¿˜æ˜¯åªéš App å‘ç‰ˆæ›´æ–°
